<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRA CỨU KẾT QUẢ TỐT NGHIỆP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .banner-ws {
            width: 100%;
            height: 200PX;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('https://th.bing.com/th/id/R.4d23723f665971529d311c5ef7f00610?rik=5zrxfhWu8WoNGA&pid=ImgRaw&r=0');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            margin: 0 0 20px 0;
            text-align: center;
        }

        .banner-ws h2 {
            color: navy;
            background: #fff5;
            padding: 5px;
            border-radius: 5px;
        }

        .container {
            width: 100%;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .f-tracuu {
            display: flex;
            flex-direction: column;
        }

        .f-captcha {
            display: flex;
            flex-direction: column;
        }

        td:nth-child(2) {
            color: red;
        }

        input[type="text"] {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            margin: 0 auto;
            padding: 10px 15px;
            background-color: navy;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: 1s ease;
        }

        button:hover {
            background-color: white;
            color: navy;
            padding: 10px 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
        }

        .cl-kq {
            width: 100%;
            overflow-x: auto;
            display: flex;
            justify-content: center;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
            white-space: nowrap;
        }

        td:hover {
            background: #fff9;
            color: navy;
        }

        th {
            background-color: navy;
            color: white;
        }

        .result {
            overflow-x: auto;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 8px solid navy;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        h4 {
            color: navy;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 767px) {
            th {
                font-size: 12px;
            }

            h2 {
                font-size: 18px;
            }
        }
    </style>
</head>

<body>
    <div class="banner-ws">
        <div>
            <a href="https://itc.edu.vn/"> <img src="./image/logo (1).png" alt="" width="70px"
                    style="background-color: #f3f3f3; border-radius: 50%; padding: 5px;"></a>
            <h2>TRƯỜNG CAO ĐẲNG CÔNG NGHỆ THÔNG TIN TP.HỒ CHÍ MINH</h2>
        </div>
    </div>
    <div class="container">
        <h3 style="color: navy; margin: 10px 0 20px 0; border-bottom: dashed 2px navy;">TRA CỨU KẾT QUẢ TỐT NGHIỆP</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <div class="f-tracuu">
                <label for="">MSSV</label>
                <input type="text" id="mssv" placeholder="Nhập mã số sinh viên" />
            </div>

            <div class="f-captcha">
                <label for="captcha">CAPTCHA: <strong id="captcha-code"></strong></label>
                <input type="text" id="captcha" placeholder="Nhập mã" />
            </div>
        </div>
        <div><button id="search-button">Tra cứu</button></div>
        <div id="loading" style="display: none;">
            <div class="loader"></div>
        </div>
        <div class="cl-kq">
            <div class="result" id="result"></div>
        </div>
    </div>
    <p style="color: red;     font-style: italic; font-size: 14px; margin: 20px 0 0 0;">*Lưu ý: Dữ liệu chỉ mang tính
        chất tham khảo</p>
    <script>
        const sheetID = '1gamv9wS8nO9FnKfcDZVqh419ypcdlBX87Px4ssDnOOU';
        const sheetName = 'tracuutn';
        let captcha = generateCaptcha();

        function generateCaptcha() {
            const captchaCode = Math.random().toString(36).substring(2, 6);
            document.getElementById('captcha-code').innerText = captchaCode;
            return captchaCode;
        }

        document.getElementById('search-button').addEventListener('click', () => {
            const mssvInput = document.getElementById('mssv').value.trim();
            const captchaInput = document.getElementById('captcha').value.trim();

            if (!mssvInput) {
                alert('Vui lòng nhập mã số sinh viên.');
                return;
            }

            if (captchaInput !== captcha) {
                alert('Mã CAPTCHA không đúng. Vui lòng thử lại.');
                captcha = generateCaptcha();
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').innerHTML = '';

            fetch(`https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`)
                .then(response => response.text())
                .then(data => {
                    const jsonData = JSON.parse(data.substr(47).slice(0, -2));
                    const rows = jsonData.table.rows;
                    let found = false;
                    let resultHtml = '<h4>Kết Quả Tra Cứu</h4><table><tr><th>MSSV</th><th>Họ và Tên</th><th>Ngày sinh</th><th>Điểm</th><th>Xếp loại</th><th>Lớp</th><th>Ngành học</th><th>Đăng ký dữ liệu</th><th>Ghi chú</th><th>Tình Trạng</th><th>Ngày tốt nghiệp</th>';

                    rows.forEach(row => {
                        const mssvCell = row.c[0] ? row.c[0].v : '';
                        if (mssvCell === mssvInput) {
                            found = true;
                            resultHtml += '<tr>';
                            row.c.forEach(cell => {
                                if (cell && cell.v) {
                                    const urlPattern = /^(http|https):\/\//;
                                    if (urlPattern.test(cell.v)) {
                                        resultHtml += `<td><a href="${cell.v}" target="_blank">Liên kết</a></td>`;
                                    } else {
                                        resultHtml += `<td>${cell.v}</td>`;
                                    }
                                } else {
                                    resultHtml += `<td></td>`;
                                }
                            });
                            resultHtml += '</tr>';
                        }
                    });

                    resultHtml += '</table>';
                    document.getElementById('result').innerHTML = found ? resultHtml : 'Không tìm thấy thông tin cho MSSV này.';

                    if (!found) {
                        alert('Thời gian tra cứu đã hết hoặc chưa đến thời gian tra cứu. Vui lòng quay lại sau.');
                        window.close();
                    }
                })
                .catch(error => console.error('Lỗi:', error))
                .finally(() => {
                    document.getElementById('loading').style.display = 'none';
                });
        });
    </script>


</body>

</html>